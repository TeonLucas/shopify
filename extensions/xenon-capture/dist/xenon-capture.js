(()=>{var Oe=Object.create;var I=Object.defineProperty;var De=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,xe=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var Z=(s,e,t)=>e in s?I(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,P=(s,e)=>{for(var t in e||(e={}))R.call(e,t)&&Z(s,t,e[t]);if(j)for(var t of j(e))Q.call(e,t)&&Z(s,t,e[t]);return s};var ee=(s,e)=>{var t={};for(var r in s)R.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&j)for(var r of j(s))e.indexOf(r)<0&&Q.call(s,r)&&(t[r]=s[r]);return t};var te=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var Pe=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Se(e))!R.call(s,n)&&n!==t&&I(s,n,{get:()=>e[n],enumerable:!(r=De(e,n))||r.enumerable});return s};var ve=(s,e,t)=>(t=s!=null?Oe(xe(s)):{},Pe(e||!s||!s.__esModule?I(t,"default",{value:s,enumerable:!0}):t,s));var re=(s,e,t)=>new Promise((r,n)=>{var a=f=>{try{p(t.next(f))}catch(c){n(c)}},d=f=>{try{p(t.throw(f))}catch(c){n(c)}},p=f=>f.done?r(f.value):Promise.resolve(f.value).then(a,d);p((t=t.apply(s,e)).next())});var ne=te((E,se)=>{(function(s,e){typeof E=="object"&&typeof se!="undefined"?e(E):typeof define=="function"&&define.amd?define(["exports"],e):e(s.WHATWGFetch={})})(E,function(s){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(o){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(o){return o&&DataView.prototype.isPrototypeOf(o)}if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(o){return o&&n.indexOf(Object.prototype.toString.call(o))>-1};function d(o){if(typeof o!="string"&&(o=String(o)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(o)||o==="")throw new TypeError('Invalid character in header field name: "'+o+'"');return o.toLowerCase()}function p(o){return typeof o!="string"&&(o=String(o)),o}function f(o){var i={next:function(){var u=o.shift();return{done:u===void 0,value:u}}};return t.iterable&&(i[Symbol.iterator]=function(){return i}),i}function c(o){this.map={},o instanceof c?o.forEach(function(i,u){this.append(u,i)},this):Array.isArray(o)?o.forEach(function(i){if(i.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+i.length);this.append(i[0],i[1])},this):o&&Object.getOwnPropertyNames(o).forEach(function(i){this.append(i,o[i])},this)}c.prototype.append=function(o,i){o=d(o),i=p(i);var u=this.map[o];this.map[o]=u?u+", "+i:i},c.prototype.delete=function(o){delete this.map[d(o)]},c.prototype.get=function(o){return o=d(o),this.has(o)?this.map[o]:null},c.prototype.has=function(o){return this.map.hasOwnProperty(d(o))},c.prototype.set=function(o,i){this.map[d(o)]=p(i)},c.prototype.forEach=function(o,i){for(var u in this.map)this.map.hasOwnProperty(u)&&o.call(i,this.map[u],u,this)},c.prototype.keys=function(){var o=[];return this.forEach(function(i,u){o.push(u)}),f(o)},c.prototype.values=function(){var o=[];return this.forEach(function(i){o.push(i)}),f(o)},c.prototype.entries=function(){var o=[];return this.forEach(function(i,u){o.push([u,i])}),f(o)},t.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);function B(o){if(!o._noBody){if(o.bodyUsed)return Promise.reject(new TypeError("Already read"));o.bodyUsed=!0}}function G(o){return new Promise(function(i,u){o.onload=function(){i(o.result)},o.onerror=function(){u(o.error)}})}function me(o){var i=new FileReader,u=G(i);return i.readAsArrayBuffer(o),u}function pe(o){var i=new FileReader,u=G(i),h=/charset=([A-Za-z0-9_-]+)/.exec(o.type),y=h?h[1]:"utf-8";return i.readAsText(o,y),u}function ye(o){for(var i=new Uint8Array(o),u=new Array(i.length),h=0;h<i.length;h++)u[h]=String.fromCharCode(i[h]);return u.join("")}function $(o){if(o.slice)return o.slice(0);var i=new Uint8Array(o.byteLength);return i.set(new Uint8Array(o)),i.buffer}function W(){return this.bodyUsed=!1,this._initBody=function(o){this.bodyUsed=this.bodyUsed,this._bodyInit=o,o?typeof o=="string"?this._bodyText=o:t.blob&&Blob.prototype.isPrototypeOf(o)?this._bodyBlob=o:t.formData&&FormData.prototype.isPrototypeOf(o)?this._bodyFormData=o:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)?this._bodyText=o.toString():t.arrayBuffer&&t.blob&&r(o)?(this._bodyArrayBuffer=$(o.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(o)||a(o))?this._bodyArrayBuffer=$(o):this._bodyText=o=Object.prototype.toString.call(o):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof o=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var o=B(this);if(o)return o;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var o=B(this);return o||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(me);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var o=B(this);if(o)return o;if(this._bodyBlob)return pe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ye(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(we)}),this.json=function(){return this.text().then(JSON.parse)},this}var be=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ge(o){var i=o.toUpperCase();return be.indexOf(i)>-1?i:o}function A(o,i){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');i=i||{};var u=i.body;if(o instanceof A){if(o.bodyUsed)throw new TypeError("Already read");this.url=o.url,this.credentials=o.credentials,i.headers||(this.headers=new c(o.headers)),this.method=o.method,this.mode=o.mode,this.signal=o.signal,!u&&o._bodyInit!=null&&(u=o._bodyInit,o.bodyUsed=!0)}else this.url=String(o);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new c(i.headers)),this.method=ge(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in e){var l=new AbortController;return l.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&u)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(u),(this.method==="GET"||this.method==="HEAD")&&(i.cache==="no-store"||i.cache==="no-cache")){var h=/([?&])_=[^&]*/;if(h.test(this.url))this.url=this.url.replace(h,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function we(o){var i=new FormData;return o.trim().split("&").forEach(function(u){if(u){var h=u.split("="),y=h.shift().replace(/\+/g," "),l=h.join("=").replace(/\+/g," ");i.append(decodeURIComponent(y),decodeURIComponent(l))}}),i}function Ae(o){var i=new c,u=o.replace(/\r?\n[\t ]+/g," ");return u.split("\r").map(function(h){return h.indexOf(`
`)===0?h.substr(1,h.length):h}).forEach(function(h){var y=h.split(":"),l=y.shift().trim();if(l){var T=y.join(":").trim();try{i.append(l,T)}catch(k){console.warn("Response "+k.message)}}}),i}W.call(A.prototype);function g(o,i){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=i.statusText===void 0?"":""+i.statusText,this.headers=new c(i.headers),this.url=i.url||"",this._initBody(o)}W.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},g.error=function(){var o=new g(null,{status:200,statusText:""});return o.ok=!1,o.status=0,o.type="error",o};var _e=[301,302,303,307,308];g.redirect=function(o,i){if(_e.indexOf(i)===-1)throw new RangeError("Invalid status code");return new g(null,{status:i,headers:{location:o}})},s.DOMException=e.DOMException;try{new s.DOMException}catch(o){s.DOMException=function(i,u){this.message=i,this.name=u;var h=Error(i);this.stack=h.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function U(o,i){return new Promise(function(u,h){var y=new A(o,i);if(y.signal&&y.signal.aborted)return h(new s.DOMException("Aborted","AbortError"));var l=new XMLHttpRequest;function T(){l.abort()}l.onload=function(){var b={statusText:l.statusText,headers:Ae(l.getAllResponseHeaders()||"")};y.url.indexOf("file://")===0&&(l.status<200||l.status>599)?b.status=200:b.status=l.status,b.url="responseURL"in l?l.responseURL:b.headers.get("X-Request-URL");var D="response"in l?l.response:l.responseText;setTimeout(function(){u(new g(D,b))},0)},l.onerror=function(){setTimeout(function(){h(new TypeError("Network request failed"))},0)},l.ontimeout=function(){setTimeout(function(){h(new TypeError("Network request timed out"))},0)},l.onabort=function(){setTimeout(function(){h(new s.DOMException("Aborted","AbortError"))},0)};function k(b){try{return b===""&&e.location.href?e.location.href:b}catch(D){return b}}if(l.open(y.method,k(y.url),!0),y.credentials==="include"?l.withCredentials=!0:y.credentials==="omit"&&(l.withCredentials=!1),"responseType"in l&&(t.blob?l.responseType="blob":t.arrayBuffer&&(l.responseType="arraybuffer")),i&&typeof i.headers=="object"&&!(i.headers instanceof c||e.Headers&&i.headers instanceof e.Headers)){var Y=[];Object.getOwnPropertyNames(i.headers).forEach(function(b){Y.push(d(b)),l.setRequestHeader(b,p(i.headers[b]))}),y.headers.forEach(function(b,D){Y.indexOf(D)===-1&&l.setRequestHeader(D,b)})}else y.headers.forEach(function(b,D){l.setRequestHeader(D,b)});y.signal&&(y.signal.addEventListener("abort",T),l.onreadystatechange=function(){l.readyState===4&&y.signal.removeEventListener("abort",T)}),l.send(typeof y._bodyInit=="undefined"?null:y._bodyInit)})}U.polyfill=!0,e.fetch||(e.fetch=U,e.Headers=c,e.Request=A,e.Response=g),s.Headers=c,s.Request=A,s.Response=g,s.fetch=U,Object.defineProperty(s,"__esModule",{value:!0})})});var ae=te((Ve,ie)=>{ne();ie.exports=self.fetch.bind(self)});var oe="WebPixel::Render";var N=s=>shopify.extend(oe,s);var Ke=ve(ae());function Te(s){return re(this,null,function*(){if(s.status>=200&&s.status<400)return s;if(s.status>=400&&s.status<500){let t=yield s.json(),r=new Error(t.error_message);return r.response=s,r.details=t,r.authIssue=!0,Promise.reject(r)}let e=new Error(s.statusText);return e.response=s,Promise.reject(e)})}function ue(s,n={}){var a=n,{accessToken:e,headers:t}=a,r=ee(a,["accessToken","headers"]);let d={accept:"application/json"},p=e?{authorization:`Bearer ${e}`}:{};return r=P({credentials:"same-origin",headers:P(P(P({},d),p),t)},r),fetch(s,r).then(Te).then(f=>[204,304].includes(f.status)?{}:f.json()).catch(f=>{if(f instanceof TypeError){let c=new Error("Your internet connection appears to have gone down.");return c.noNet=!0,Promise.reject(c)}return Promise.reject(f)})}var je="app.xenonview.com",Ee=`https://${je}`,F=class{constructor(e={}){let{name:t,method:r,headers:n,url:a,skipName:d,authenticated:p,apiUrl:f}=e;this.authenticated=p||!1,this.skipName=d||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=n||{"content-type":"application/json"},this.apiUrl=f||f!=null?f:Ee,this.path_=a||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(a){return Promise.reject(a)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let a={parameters:t};this.skipName||(a.name=this.name);let d=JSON.stringify(a);r.body=d}if(this.authenticated){let{token:a}=e;if(a)r.accessToken=a;else return Promise.reject(new Error("No token and authenticated!"))}let n=`${this.apiUrl}/${this.path(e)}`;return ue(n,r)}},_=F;function Ce(s){let{journey:e}=s;return e?{journey:e}:{}}var L=class extends _{constructor(e){let t={name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Ce(e),{id:r,timestamp:n}=e;return t.uuid=r,t.timestamp=n,t}};function Be(s){return new L(s)}var ce=Be;function Ue(s){let{journey:e}=s;return e?{journey:e}:{}}var H=class extends _{constructor(e){let t={name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Ue(e),{id:r,tags:n,platform:a,timestamp:d,watchdog:p}=e;return t.uuid=r,t.timestamp=d,t.tags=n,t.platform=a,p&&(t.watchdog=p),t}};function ke(s){return new H(s)}var le=ke;var J=class extends _{constructor(e){let t={name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t,person:r,timestamp:n}=e;if(!r)throw new Error("No person data received.");let a={};return a.uuid=t,a.person=r,a.timestamp=n,a}};function Ie(s){return new J(s)}var de=Ie;var X=class extends _{constructor(e){let t={name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t}=e,r={};return r.uuid=t,r}};function Re(s){return new X(s)}var fe=Re;var M={},Ne={setItem:(s,e)=>M[s]=e,getItem:s=>M[s],removeItem:s=>delete M[s]},q={},Fe={setItem:(s,e)=>q[s]=e,getItem:s=>q[s],removeItem:s=>delete q[s]};function z(){return typeof window!="undefined"&&window!==void 0&&window&&window.localStorage?window.localStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.localStorage?browser.localStorage:Fe}function V(){return typeof window!="undefined"&&window!==void 0&&window&&window.sessionStorage?window.sessionStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.sessionStorage?browser.sessionStorage:Ne}function w(s,e){z().setItem(s,JSON.stringify(e))}function S(s){let e=z().getItem(s);return e?JSON.parse(e):null}function v(s){z().removeItem(s)}function x(s,e){V().setItem(s,JSON.stringify(e))}function O(s){let e=V().getItem(s);return e?JSON.parse(e):null}function K(s){V().removeItem(s)}var C=class{constructor(e=null,t="https://app.xenonview.com",r=ce,n=de,a=le,d=fe){this.JourneyApi=r,this.DeanonApi=n,this.HeartbeatApi=a,this.SampleApi=d,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiUrl=t,e&&this.init(e,t)}init(e,t="https://app.xenonview.com",r=null){this.apiUrl=t,this.apiKey=e,this.sampleDecision(null,r)}ecomAbandonment(){w("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){w("heartbeat_type","custom"),w("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){w("heartbeat_type","custom"),w("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,n){x("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:n})}removePlatform(){K("view-platform")}variant(e){x("view-tags",e)}resetVariants(){K("view-tags")}leadAttributed(e,t){let r={superOutcome:"Lead Attributed",outcome:e,result:"success"};t&&(r.id=t),this.outcomeAdd(r)}leadCaptured(e){let t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){let t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){let t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){let t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){let e={superOutcome:"Application Installation",outcome:"Installed",result:"success"};this.outcomeAdd(e)}applicationNotInstalled(){let e={superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"};this.outcomeAdd(e)}initialSubscription(e,t=null,r=null,n=null){let a={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionDeclined(e,t=null,r=null,n=null){let a={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionRenewed(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionPaused(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionCanceled(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionUpsold(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionUpsellDeclined(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionDownsell(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}adClicked(e,t=null,r=null){let n={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(n.id=t),r&&(n.price=r),this.outcomeAdd(n)}adIgnored(e,t=null,r=null){let n={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(n.id=t),r&&(n.price=r),this.outcomeAdd(n)}referral(e,t=null){let r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){let r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t),this.heartbeatState(1)}productNotAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r)}upsellDismissed(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(){let e={superOutcome:"Customer Checkout",outcome:"Check Out",result:"success"};this.outcomeAdd(e),this.heartbeatState(2)}checkoutCanceled(){let e={superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"};this.outcomeAdd(e)}productRemoved(e){let t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null){let r={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r),this.heartbeatState(3)}purchaseCancel(e=null,t=null){let n={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(n.price=t),this.outcomeAdd(n)}promiseFulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"};this.outcomeAdd(e)}promiseUnfulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"};this.outcomeAdd(e)}productKept(e){let t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){let t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){let r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){let r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){let r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){let r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){let n={category:"Content",action:"Edited",type:e};t&&(n.identifier=t),r&&(n.details=r),this.journeyAdd(n)}contentCreated(e,t=null){let r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){let r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){let r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){let r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){let t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){let r={category:"Performance",action:"Page Load Time - "+e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,n){let a={category:e,action:t,name:r,details:n};this.journeyAdd(a)}commit(e=!1){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(t).catch(r=>(this.restore(),e?Promise.reject(r):Promise.resolve(!0)))}heartbeatState(e=null){let t=S("heartbeat_stage");return e&&e>t&&w("heartbeat_stage",e),!e&&!t&&w("heartbeat_stage",0),Number(S("heartbeat_stage"))}heartbeatMessage(e){let t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:S("heartbeat_outcome")}heartbeat(e=!1){let t=O("view-platform"),r=O("view-tags"),n={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:new Date().getTime()/1e3}},a=S("heartbeat_type");return a&&(n.data.watchdog=this.heartbeatMessage(a)),this.sampleDecision()?(this.reset(),this.HeartbeatApi(this.apiUrl).fetch(n).then(d=>(a&&Object.keys(n.data.watchdog).includes("remove")&&(v("heartbeat_stage"),v("heartbeat_type"),v("heartbeat_outcome")),Promise.resolve(d))).catch(d=>(this.restore(),e?Promise.reject(d):Promise.resolve(!0)))):Promise.resolve(!0)}deanonymize(e){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&x("xenon-view",e),e=O("xenon-view"),!e||e===""?this.newId():e}newId(){return x("xenon-view",crypto.randomUUID()),O("xenon-view")}sampleDecision(e=null,t=null){if(e!==null&&x("xenon-will-sample",e),e=O("xenon-will-sample"),e===null||e===""){let r={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(r).then(n=>{e=this.sampleDecision(n.sample,t)}).catch(n=>{if(n.authIssue&&t){t(n);return}e=this.sampleDecision(!0,t)})}return e=e!==null?!!e:null,e}outcomeAdd(e){let t=O("view-platform");t&&(e.platform=t);let r=O("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=new Date().getTime()/1e3,t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let n=r.hasOwnProperty("count")?r.count:1;r.count=n+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){let r=Object.keys(e),n=Object.keys(t);return!((d,p)=>{for(let f of p)if(!d.has(f))return!1;return!0})(new Set(r),new Set(n))||!n.includes("category")||!r.includes("category")||t.category!==e.category||!n.includes("action")||!r.includes("action")||t.action!==e.action?!1:this.duplicateFeature(e,t,r,n)||this.duplicateContent(e,t,r,n)||this.duplicateMilestone(e,t,r,n)}duplicateFeature(e,t,r,n){return t.category!=="Feature"||e.category!=="Feature"?!1:t.name===e.name}duplicateContent(e,t,r,n){return t.category!=="Content"||e.category!=="Content"?!1:!n.includes("type")&&!r.includes("type")?!0:t.type!==e.type?!1:!n.includes("identifier")&&!r.includes("identifier")?!0:t.identifier!==e.identifier?!1:!n.includes("details")&&!r.includes("details")?!0:t.details===e.details}duplicateMilestone(e,t,r,n){return t.category==="Feature"||e.category==="Feature"||t.category==="Content"||e.category==="Content"||t.name!==e.name?!1:t.details===e.details}journey(){return S("view-journey")}storeJourney(e){w("view-journey",e)}reset(){this.restoreJourney=this.journey(),v("view-journey"),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){let n=(a,d,p,f)=>f>=p?!1:a.className.toString().includes(d)?!0:a.parentElement?n(a.parentElement,d,p,f+1):!1;return n(e,t,r,0)}};var Le=new C,m=Le;var he=s=>{console.log("xenon-capture:%c Error: "+s,"color: #ff0000")};N(s=>{let e=s.settings.debug&&(s.settings.debug==="1"||s.settings.debug.toLowerCase()==="true"),t=(r,...n)=>{e&&console.log("%c"+r,"color: #3333cc",...n)};s.settings.apiKey?m.init(s.settings.apiKey,null,r=>{he(r.message)}):he("No API Key configured"),t("Xenon app settings",s.settings),s.analytics.subscribe("all_events",r=>{switch(r.name){case"checkout_contact_info_submitted":let n={email:r.data.checkout.email,name:[r.data.checkout.billingAddress.firstName,r.data.checkout.billingAddress.lastName].join(" ")};m.deanonymize(n).then(()=>{m.heartbeat().then()}),t("Xenon.deanonymize",n);break;case"checkout_shipping_info_submitted":m.contentCreated("shipping"),m.heartbeat().then(),t("Xenon.contentCreated shipping");break;case"payment_info_submitted":m.contentCreated("billing"),m.heartbeat().then(),t("Xenon.contentCreated billing");break;case"checkout_completed":m.milestone("Selection","Payment","Flow",paymentFlow),m.heartbeat().then(),t("Xenon.milestone","Selection","Payment","Flow",paymentFlow),r.data.checkout.transactions.map(c=>{m.milestone("Selection","Payment","Used",c.gateway),t("Xenon.milestone","Selection","Payment","Used",c.gateway)}),m.heartbeat();let a=r.data.checkout.lineItems.map(c=>c.id),d=r.data.checkout.totalPrice.amount;m.purchase(a,d),t("Xenon.purchase",a,d),m.heartbeat();break;case"clicked":if(r.data.element.tagName!=="INPUT"){let c=r.data.element.tagName.charAt(0)+r.data.element.tagName.slice(1).toLowerCase();m.milestone(c,r.data.element.id,r.data.element.type,r.data.element.value),t("Xenon.milestone",c,r.data.element.id,r.data.element.type,r.data.element.value),m.heartbeat()}break;case"input_changed":m.milestone("Input",r.data.element.id,r.data.element.type,r.data.element.value),t("Xenon.milestone","Input",r.data.element.id,r.data.element.type,r.data.element.value),m.heartbeat();break;case"xenon_link":m.milestone("Link",r.customData.id,r.customData.href,r.customData.text),t("Xenon.milestone","Link",r.customData.id,r.customData.href,r.customData.text),m.heartbeat();break;case"xenon_input":let p="Input"+r.customData.type.charAt(0).toUpperCase()+r.customData.type.slice(1);m.milestone(p,r.customData.id,r.customData.class,r.customData.text),t("Xenon.milestone",p,r.customData.id,r.customData.class,r.customData.text),m.heartbeat();break;case"xenon_button":let f="Button"+r.customData.type.charAt(0).toUpperCase()+r.customData.type.slice(1);m.milestone(f,r.customData.id,r.customData.class,r.customData.text),t("Xenon.milestone",f,r.customData.id,r.customData.class,r.customData.text),m.heartbeat();break;case"xenon_timing":m.pageLoadTime(r.customData.loadTime.toString(),r.customData.href),t("Xenon.pageLoadTime:",r.customData),m.heartbeat();break;default:e&&console.log("%cXenon unmapped:","color: #dd571c",r)}})});})();
