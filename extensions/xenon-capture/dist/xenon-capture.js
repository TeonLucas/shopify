(()=>{var _e=Object.create;var I=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols,Pe=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var Z=(n,e,t)=>e in n?I(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,x=(n,e)=>{for(var t in e||(e={}))R.call(e,t)&&Z(n,t,e[t]);if(E)for(var t of E(e))Q.call(e,t)&&Z(n,t,e[t]);return n};var ee=(n,e)=>{var t={};for(var r in n)R.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&E)for(var r of E(n))e.indexOf(r)<0&&Q.call(n,r)&&(t[r]=n[r]);return t};var te=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var xe=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Se(e))!R.call(n,s)&&s!==t&&I(n,s,{get:()=>e[s],enumerable:!(r=Oe(e,s))||r.enumerable});return n};var je=(n,e,t)=>(t=n!=null?_e(Pe(n)):{},xe(e||!n||!n.__esModule?I(t,"default",{value:n,enumerable:!0}):t,n));var re=(n,e,t)=>new Promise((r,s)=>{var a=h=>{try{m(t.next(h))}catch(d){s(d)}},l=h=>{try{m(t.throw(h))}catch(d){s(d)}},m=h=>h.done?r(h.value):Promise.resolve(h.value).then(a,l);m((t=t.apply(n,e)).next())});var se=te((D,ne)=>{(function(n,e){typeof D=="object"&&typeof ne!="undefined"?e(D):typeof define=="function"&&define.amd?define(["exports"],e):e(n.WHATWGFetch={})})(D,function(n){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(o){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(o){return o&&DataView.prototype.isPrototypeOf(o)}if(t.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(o){return o&&s.indexOf(Object.prototype.toString.call(o))>-1};function l(o){if(typeof o!="string"&&(o=String(o)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(o)||o==="")throw new TypeError('Invalid character in header field name: "'+o+'"');return o.toLowerCase()}function m(o){return typeof o!="string"&&(o=String(o)),o}function h(o){var i={next:function(){var u=o.shift();return{done:u===void 0,value:u}}};return t.iterable&&(i[Symbol.iterator]=function(){return i}),i}function d(o){this.map={},o instanceof d?o.forEach(function(i,u){this.append(u,i)},this):Array.isArray(o)?o.forEach(function(i){if(i.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+i.length);this.append(i[0],i[1])},this):o&&Object.getOwnPropertyNames(o).forEach(function(i){this.append(i,o[i])},this)}d.prototype.append=function(o,i){o=l(o),i=m(i);var u=this.map[o];this.map[o]=u?u+", "+i:i},d.prototype.delete=function(o){delete this.map[l(o)]},d.prototype.get=function(o){return o=l(o),this.has(o)?this.map[o]:null},d.prototype.has=function(o){return this.map.hasOwnProperty(l(o))},d.prototype.set=function(o,i){this.map[l(o)]=m(i)},d.prototype.forEach=function(o,i){for(var u in this.map)this.map.hasOwnProperty(u)&&o.call(i,this.map[u],u,this)},d.prototype.keys=function(){var o=[];return this.forEach(function(i,u){o.push(u)}),h(o)},d.prototype.values=function(){var o=[];return this.forEach(function(i){o.push(i)}),h(o)},d.prototype.entries=function(){var o=[];return this.forEach(function(i,u){o.push([u,i])}),h(o)},t.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function B(o){if(!o._noBody){if(o.bodyUsed)return Promise.reject(new TypeError("Already read"));o.bodyUsed=!0}}function G(o){return new Promise(function(i,u){o.onload=function(){i(o.result)},o.onerror=function(){u(o.error)}})}function pe(o){var i=new FileReader,u=G(i);return i.readAsArrayBuffer(o),u}function me(o){var i=new FileReader,u=G(i),f=/charset=([A-Za-z0-9_-]+)/.exec(o.type),p=f?f[1]:"utf-8";return i.readAsText(o,p),u}function ye(o){for(var i=new Uint8Array(o),u=new Array(i.length),f=0;f<i.length;f++)u[f]=String.fromCharCode(i[f]);return u.join("")}function $(o){if(o.slice)return o.slice(0);var i=new Uint8Array(o.byteLength);return i.set(new Uint8Array(o)),i.buffer}function W(){return this.bodyUsed=!1,this._initBody=function(o){this.bodyUsed=this.bodyUsed,this._bodyInit=o,o?typeof o=="string"?this._bodyText=o:t.blob&&Blob.prototype.isPrototypeOf(o)?this._bodyBlob=o:t.formData&&FormData.prototype.isPrototypeOf(o)?this._bodyFormData=o:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)?this._bodyText=o.toString():t.arrayBuffer&&t.blob&&r(o)?(this._bodyArrayBuffer=$(o.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(o)||a(o))?this._bodyArrayBuffer=$(o):this._bodyText=o=Object.prototype.toString.call(o):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof o=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var o=B(this);if(o)return o;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var o=B(this);return o||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(pe);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var o=B(this);if(o)return o;if(this._bodyBlob)return me(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ye(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(we)}),this.json=function(){return this.text().then(JSON.parse)},this}var be=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ge(o){var i=o.toUpperCase();return be.indexOf(i)>-1?i:o}function A(o,i){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');i=i||{};var u=i.body;if(o instanceof A){if(o.bodyUsed)throw new TypeError("Already read");this.url=o.url,this.credentials=o.credentials,i.headers||(this.headers=new d(o.headers)),this.method=o.method,this.mode=o.mode,this.signal=o.signal,!u&&o._bodyInit!=null&&(u=o._bodyInit,o.bodyUsed=!0)}else this.url=String(o);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new d(i.headers)),this.method=ge(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in e){var c=new AbortController;return c.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&u)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(u),(this.method==="GET"||this.method==="HEAD")&&(i.cache==="no-store"||i.cache==="no-cache")){var f=/([?&])_=[^&]*/;if(f.test(this.url))this.url=this.url.replace(f,"$1_="+new Date().getTime());else{var p=/\?/;this.url+=(p.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function we(o){var i=new FormData;return o.trim().split("&").forEach(function(u){if(u){var f=u.split("="),p=f.shift().replace(/\+/g," "),c=f.join("=").replace(/\+/g," ");i.append(decodeURIComponent(p),decodeURIComponent(c))}}),i}function Ae(o){var i=new d,u=o.replace(/\r?\n[\t ]+/g," ");return u.split("\r").map(function(f){return f.indexOf(`
`)===0?f.substr(1,f.length):f}).forEach(function(f){var p=f.split(":"),c=p.shift().trim();if(c){var T=p.join(":").trim();try{i.append(c,T)}catch(U){console.warn("Response "+U.message)}}}),i}W.call(A.prototype);function g(o,i){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=i.statusText===void 0?"":""+i.statusText,this.headers=new d(i.headers),this.url=i.url||"",this._initBody(o)}W.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},g.error=function(){var o=new g(null,{status:200,statusText:""});return o.ok=!1,o.status=0,o.type="error",o};var ve=[301,302,303,307,308];g.redirect=function(o,i){if(ve.indexOf(i)===-1)throw new RangeError("Invalid status code");return new g(null,{status:i,headers:{location:o}})},n.DOMException=e.DOMException;try{new n.DOMException}catch(o){n.DOMException=function(i,u){this.message=i,this.name=u;var f=Error(i);this.stack=f.stack},n.DOMException.prototype=Object.create(Error.prototype),n.DOMException.prototype.constructor=n.DOMException}function k(o,i){return new Promise(function(u,f){var p=new A(o,i);if(p.signal&&p.signal.aborted)return f(new n.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function T(){c.abort()}c.onload=function(){var b={statusText:c.statusText,headers:Ae(c.getAllResponseHeaders()||"")};p.url.indexOf("file://")===0&&(c.status<200||c.status>599)?b.status=200:b.status=c.status,b.url="responseURL"in c?c.responseURL:b.headers.get("X-Request-URL");var O="response"in c?c.response:c.responseText;setTimeout(function(){u(new g(O,b))},0)},c.onerror=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){f(new TypeError("Network request timed out"))},0)},c.onabort=function(){setTimeout(function(){f(new n.DOMException("Aborted","AbortError"))},0)};function U(b){try{return b===""&&e.location.href?e.location.href:b}catch(O){return b}}if(c.open(p.method,U(p.url),!0),p.credentials==="include"?c.withCredentials=!0:p.credentials==="omit"&&(c.withCredentials=!1),"responseType"in c&&(t.blob?c.responseType="blob":t.arrayBuffer&&(c.responseType="arraybuffer")),i&&typeof i.headers=="object"&&!(i.headers instanceof d||e.Headers&&i.headers instanceof e.Headers)){var Y=[];Object.getOwnPropertyNames(i.headers).forEach(function(b){Y.push(l(b)),c.setRequestHeader(b,m(i.headers[b]))}),p.headers.forEach(function(b,O){Y.indexOf(O)===-1&&c.setRequestHeader(O,b)})}else p.headers.forEach(function(b,O){c.setRequestHeader(O,b)});p.signal&&(p.signal.addEventListener("abort",T),c.onreadystatechange=function(){c.readyState===4&&p.signal.removeEventListener("abort",T)}),c.send(typeof p._bodyInit=="undefined"?null:p._bodyInit)})}k.polyfill=!0,e.fetch||(e.fetch=k,e.Headers=d,e.Request=A,e.Response=g),n.Headers=d,n.Request=A,n.Response=g,n.fetch=k,Object.defineProperty(n,"__esModule",{value:!0})})});var ae=te((Ve,ie)=>{se();ie.exports=self.fetch.bind(self)});var oe="WebPixel::Render";var F=n=>shopify.extend(oe,n);var Ke=je(ae());function Te(n){return re(this,null,function*(){if(n.status>=200&&n.status<400)return n;if(n.status>=400&&n.status<500){let t=yield n.json(),r=new Error(t.error_message);return r.response=n,r.details=t,r.authIssue=!0,Promise.reject(r)}let e=new Error(n.statusText);return e.response=n,Promise.reject(e)})}function ue(n,s={}){var a=s,{accessToken:e,headers:t}=a,r=ee(a,["accessToken","headers"]);let l={accept:"application/json"},m=e?{authorization:`Bearer ${e}`}:{};return r=x({credentials:"same-origin",headers:x(x(x({},l),m),t)},r),fetch(n,r).then(Te).then(h=>[204,304].includes(h.status)?{}:h.json()).catch(h=>{if(h instanceof TypeError){let d=new Error("Your internet connection appears to have gone down.");return d.noNet=!0,Promise.reject(d)}return Promise.reject(h)})}var Ee="app.xenonview.com",De=`https://${Ee}`,N=class{constructor(e={}){let{name:t,method:r,headers:s,url:a,skipName:l,authenticated:m,apiUrl:h}=e;this.authenticated=m||!1,this.skipName=l||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=s||{"content-type":"application/json"},this.apiUrl=h||h!=null?h:De,this.path_=a||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(a){return Promise.reject(a)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let a={parameters:t};this.skipName||(a.name=this.name);let l=JSON.stringify(a);r.body=l}if(this.authenticated){let{token:a}=e;if(a)r.accessToken=a;else return Promise.reject(new Error("No token and authenticated!"))}let s=`${this.apiUrl}/${this.path(e)}`;return ue(s,r)}},v=N;function Ce(n){let{journey:e}=n;return e?{journey:e}:{}}var L=class extends v{constructor(e){let t={name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Ce(e),{id:r,timestamp:s}=e;return t.uuid=r,t.timestamp=s,t}};function Be(n){return new L(n)}var ce=Be;function ke(n){let{journey:e}=n;return e?{journey:e}:{}}var H=class extends v{constructor(e){let t={name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0};super(t)}params(e){let t=ke(e),{id:r,tags:s,platform:a,timestamp:l,watchdog:m}=e;return t.uuid=r,t.timestamp=l,t.tags=s,t.platform=a,m&&(t.watchdog=m),t}};function Ue(n){return new H(n)}var le=Ue;var J=class extends v{constructor(e){let t={name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t,person:r,timestamp:s}=e;if(!r)throw new Error("No person data received.");let a={};return a.uuid=t,a.person=r,a.timestamp=s,a}};function Ie(n){return new J(n)}var de=Ie;var M=class extends v{constructor(e){let t={name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t}=e,r={};return r.uuid=t,r}};function Re(n){return new M(n)}var fe=Re;var X={},Fe={setItem:(n,e)=>X[n]=e,getItem:n=>X[n],removeItem:n=>delete X[n]},q={},Ne={setItem:(n,e)=>q[n]=e,getItem:n=>q[n],removeItem:n=>delete q[n]};function z(){return typeof window!="undefined"&&window!==void 0&&window&&window.localStorage?window.localStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.localStorage?browser.localStorage:Ne}function V(){return typeof window!="undefined"&&window!==void 0&&window&&window.sessionStorage?window.sessionStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.sessionStorage?browser.sessionStorage:Fe}function w(n,e){z().setItem(n,JSON.stringify(e))}function S(n){let e=z().getItem(n);return e?JSON.parse(e):null}function j(n){z().removeItem(n)}function P(n,e){V().setItem(n,JSON.stringify(e))}function _(n){let e=V().getItem(n);return e?JSON.parse(e):null}function K(n){V().removeItem(n)}var C=class{constructor(e=null,t="https://app.xenonview.com",r=ce,s=de,a=le,l=fe){this.JourneyApi=r,this.DeanonApi=s,this.HeartbeatApi=a,this.SampleApi=l,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiUrl=t,e&&this.init(e,t)}init(e,t="https://app.xenonview.com",r=null){this.apiUrl=t,this.apiKey=e,this.sampleDecision(null,r)}ecomAbandonment(){w("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){w("heartbeat_type","custom"),w("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){w("heartbeat_type","custom"),w("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,s){P("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:s})}removePlatform(){K("view-platform")}variant(e){P("view-tags",e)}resetVariants(){K("view-tags")}leadAttributed(e,t){let r={superOutcome:"Lead Attributed",outcome:e,result:"success"};t&&(r.id=t),this.outcomeAdd(r)}leadCaptured(e){let t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){let t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){let t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){let t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){let e={superOutcome:"Application Installation",outcome:"Installed",result:"success"};this.outcomeAdd(e)}applicationNotInstalled(){let e={superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"};this.outcomeAdd(e)}initialSubscription(e,t=null,r=null,s=null){let a={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionDeclined(e,t=null,r=null,s=null){let a={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionRenewed(e,t=null,r=null,s=null){let a={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionPaused(e,t=null,r=null,s=null){let a={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionCanceled(e,t=null,r=null,s=null){let a={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionUpsold(e,t=null,r=null,s=null){let a={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionUpsellDeclined(e,t=null,r=null,s=null){let a={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}subscriptionDownsell(e,t=null,r=null,s=null){let a={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),s&&(a.term=s),this.outcomeAdd(a)}adClicked(e,t=null,r=null){let s={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(s.id=t),r&&(s.price=r),this.outcomeAdd(s)}adIgnored(e,t=null,r=null){let s={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(s.id=t),r&&(s.price=r),this.outcomeAdd(s)}referral(e,t=null){let r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){let r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t),this.heartbeatState(1)}productNotAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r)}upsellDismissed(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(){let e={superOutcome:"Customer Checkout",outcome:"Check Out",result:"success"};this.outcomeAdd(e),this.heartbeatState(2)}checkoutCanceled(){let e={superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"};this.outcomeAdd(e)}productRemoved(e){let t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null){let r={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r),this.heartbeatState(3)}purchaseCancel(e=null,t=null){let s={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(s.price=t),this.outcomeAdd(s)}promiseFulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"};this.outcomeAdd(e)}promiseUnfulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"};this.outcomeAdd(e)}productKept(e){let t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){let t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){let r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){let r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){let r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){let r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){let s={category:"Content",action:"Edited",type:e};t&&(s.identifier=t),r&&(s.details=r),this.journeyAdd(s)}contentCreated(e,t=null){let r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){let r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){let r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){let r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){let t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){let r={category:"Performance",action:"Page Load Time - "+e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,s){let a={category:e,action:t,name:r,details:s};this.journeyAdd(a)}commit(e=!1){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(t).catch(r=>(this.restore(),e?Promise.reject(r):Promise.resolve(!0)))}heartbeatState(e=null){let t=S("heartbeat_stage");return e&&e>t&&w("heartbeat_stage",e),!e&&!t&&w("heartbeat_stage",0),Number(S("heartbeat_stage"))}heartbeatMessage(e){let t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:S("heartbeat_outcome")}heartbeat(e=!1){let t=_("view-platform"),r=_("view-tags"),s={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:new Date().getTime()/1e3}},a=S("heartbeat_type");return a&&(s.data.watchdog=this.heartbeatMessage(a)),this.sampleDecision()?(this.reset(),this.HeartbeatApi(this.apiUrl).fetch(s).then(l=>(a&&Object.keys(s.data.watchdog).includes("remove")&&(j("heartbeat_stage"),j("heartbeat_type"),j("heartbeat_outcome")),Promise.resolve(l))).catch(l=>(this.restore(),e?Promise.reject(l):Promise.resolve(!0)))):Promise.resolve(!0)}deanonymize(e){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&P("xenon-view",e),e=_("xenon-view"),!e||e===""?this.newId():e}newId(){return P("xenon-view",crypto.randomUUID()),_("xenon-view")}sampleDecision(e=null,t=null){if(e!==null&&P("xenon-will-sample",e),e=_("xenon-will-sample"),e===null||e===""){let r={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(r).then(s=>{e=this.sampleDecision(s.sample,t)}).catch(s=>{if(s.authIssue&&t){t(s);return}e=this.sampleDecision(!0,t)})}return e=e!==null?!!e:null,e}outcomeAdd(e){let t=_("view-platform");t&&(e.platform=t);let r=_("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=new Date().getTime()/1e3,t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let s=r.hasOwnProperty("count")?r.count:1;r.count=s+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){let r=Object.keys(e),s=Object.keys(t);return!((l,m)=>{for(let h of m)if(!l.has(h))return!1;return!0})(new Set(r),new Set(s))||!s.includes("category")||!r.includes("category")||t.category!==e.category||!s.includes("action")||!r.includes("action")||t.action!==e.action?!1:this.duplicateFeature(e,t,r,s)||this.duplicateContent(e,t,r,s)||this.duplicateMilestone(e,t,r,s)}duplicateFeature(e,t,r,s){return t.category!=="Feature"||e.category!=="Feature"?!1:t.name===e.name}duplicateContent(e,t,r,s){return t.category!=="Content"||e.category!=="Content"?!1:!s.includes("type")&&!r.includes("type")?!0:t.type!==e.type?!1:!s.includes("identifier")&&!r.includes("identifier")?!0:t.identifier!==e.identifier?!1:!s.includes("details")&&!r.includes("details")?!0:t.details===e.details}duplicateMilestone(e,t,r,s){return t.category==="Feature"||e.category==="Feature"||t.category==="Content"||e.category==="Content"||t.name!==e.name?!1:t.details===e.details}journey(){return S("view-journey")}storeJourney(e){w("view-journey",e)}reset(){this.restoreJourney=this.journey(),j("view-journey"),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){let s=(a,l,m,h)=>h>=m?!1:a.className.toString().includes(l)?!0:a.parentElement?s(a.parentElement,l,m,h+1):!1;return s(e,t,r,0)}};var Le=new C,y=Le;var he=n=>{console.log("xenon-capture:%c Error: "+n,"color: #ff0000")};F(n=>{let e=n.settings.debug&&(n.settings.debug==="1"||n.settings.debug.toLowerCase()==="true");n.settings.apiKey?y.init(n.settings.apiKey,null,t=>{he(t.message)}):he("No API Key configured"),e&&console.log("xenon-capture settings:",n.settings),n.analytics.subscribe("all_events",t=>{switch(e&&console.log("xenon-capture event:",t),t.name){case"checkout_contact_info_submitted":let r={email:t.data.checkout.email,name:[t.data.checkout.billingAddress.firstName,t.data.checkout.billingAddress.lastName].join(" ")};y.deanonymize(r).then(()=>{y.heartbeat().then()}),e&&console.log("Xenon.deanonymize",r);break;case"checkout_shipping_info_submitted":y.contentCreated("shipping"),y.heartbeat().then(),e&&console.log("Xenon.contentCreated shipping");break;case"payment_info_submitted":y.contentCreated("billing"),y.heartbeat().then(),e&&console.log("Xenon.contentCreated billing");break;case"checkout_completed":y.milestone("Selection","Payment","Flow",paymentFlow),y.heartbeat().then(),e&&console.log("Xenon.milestone selectionPaymentFlow",paymentFlow),t.data.checkout.transactions.map(l=>{y.milestone("Selection","Payment","Used",l.gateway),e&&console.log("Xenon.milestone selection Payment Used",l.gateway)}),y.heartbeat();let s=t.data.checkout.lineItems.map(l=>l.id),a=t.data.checkout.totalPrice.amount;y.purchase(s,a),e&&console.log("Xenon.purchase",s,a),y.heartbeat();break;case"clicked":t.data.element.id==="summary_pay_button"&&(n.browser.sessionStorage.setItem("xenon-paymentFlow","payment_basic"),e&&console.log("xenon-capture paymentFlow = payment_basic"));break;case"input_changed":y.milestone("Selection",t.data.element.id,t.data.element.type,t.data.element.value),e&&console.log("Xenon.milestone selection",t.data.element.id,t.data.element.type,t.data.element.value),y.heartbeat();break;case"xenon_link":y.milestone("Link",t.customData.id,t.customData.href,t.customData.text),e&&console.log("Xenon.milestone link:",t.customData),y.heartbeat();break;case"xenon_timing":y.pageLoadTime(t.customData.loadTime.toString(),t.customData.href),e&&console.log("Xenon.pageLoadTime:",t.customData),y.heartbeat();break;default:}})});})();
