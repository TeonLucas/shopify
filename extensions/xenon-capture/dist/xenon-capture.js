(()=>{var Oe=Object.create;var I=Object.defineProperty;var xe=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,Pe=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var Z=(s,e,t)=>e in s?I(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,T=(s,e)=>{for(var t in e||(e={}))R.call(e,t)&&Z(s,t,e[t]);if(j)for(var t of j(e))ee.call(e,t)&&Z(s,t,e[t]);return s};var te=(s,e)=>{var t={};for(var r in s)R.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&j)for(var r of j(s))e.indexOf(r)<0&&ee.call(s,r)&&(t[r]=s[r]);return t};var re=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var Te=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Se(e))!R.call(s,n)&&n!==t&&I(s,n,{get:()=>e[n],enumerable:!(r=xe(e,n))||r.enumerable});return s};var ve=(s,e,t)=>(t=s!=null?Oe(Pe(s)):{},Te(e||!s||!s.__esModule?I(t,"default",{value:s,enumerable:!0}):t,s));var oe=(s,e,t)=>new Promise((r,n)=>{var a=h=>{try{m(t.next(h))}catch(f){n(f)}},l=h=>{try{m(t.throw(h))}catch(f){n(f)}},m=h=>h.done?r(h.value):Promise.resolve(h.value).then(a,l);m((t=t.apply(s,e)).next())});var ie=re((E,ne)=>{(function(s,e){typeof E=="object"&&typeof ne!="undefined"?e(E):typeof define=="function"&&define.amd?define(["exports"],e):e(s.WHATWGFetch={})})(E,function(s){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(o){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(o){return o&&DataView.prototype.isPrototypeOf(o)}if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(o){return o&&n.indexOf(Object.prototype.toString.call(o))>-1};function l(o){if(typeof o!="string"&&(o=String(o)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(o)||o==="")throw new TypeError('Invalid character in header field name: "'+o+'"');return o.toLowerCase()}function m(o){return typeof o!="string"&&(o=String(o)),o}function h(o){var i={next:function(){var u=o.shift();return{done:u===void 0,value:u}}};return t.iterable&&(i[Symbol.iterator]=function(){return i}),i}function f(o){this.map={},o instanceof f?o.forEach(function(i,u){this.append(u,i)},this):Array.isArray(o)?o.forEach(function(i){if(i.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+i.length);this.append(i[0],i[1])},this):o&&Object.getOwnPropertyNames(o).forEach(function(i){this.append(i,o[i])},this)}f.prototype.append=function(o,i){o=l(o),i=m(i);var u=this.map[o];this.map[o]=u?u+", "+i:i},f.prototype.delete=function(o){delete this.map[l(o)]},f.prototype.get=function(o){return o=l(o),this.has(o)?this.map[o]:null},f.prototype.has=function(o){return this.map.hasOwnProperty(l(o))},f.prototype.set=function(o,i){this.map[l(o)]=m(i)},f.prototype.forEach=function(o,i){for(var u in this.map)this.map.hasOwnProperty(u)&&o.call(i,this.map[u],u,this)},f.prototype.keys=function(){var o=[];return this.forEach(function(i,u){o.push(u)}),h(o)},f.prototype.values=function(){var o=[];return this.forEach(function(i){o.push(i)}),h(o)},f.prototype.entries=function(){var o=[];return this.forEach(function(i,u){o.push([u,i])}),h(o)},t.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function g(o){if(!o._noBody){if(o.bodyUsed)return Promise.reject(new TypeError("Already read"));o.bodyUsed=!0}}function $(o){return new Promise(function(i,u){o.onload=function(){i(o.result)},o.onerror=function(){u(o.error)}})}function me(o){var i=new FileReader,u=$(i);return i.readAsArrayBuffer(o),u}function ye(o){var i=new FileReader,u=$(i),p=/charset=([A-Za-z0-9_-]+)/.exec(o.type),y=p?p[1]:"utf-8";return i.readAsText(o,y),u}function be(o){for(var i=new Uint8Array(o),u=new Array(i.length),p=0;p<i.length;p++)u[p]=String.fromCharCode(i[p]);return u.join("")}function W(o){if(o.slice)return o.slice(0);var i=new Uint8Array(o.byteLength);return i.set(new Uint8Array(o)),i.buffer}function Q(){return this.bodyUsed=!1,this._initBody=function(o){this.bodyUsed=this.bodyUsed,this._bodyInit=o,o?typeof o=="string"?this._bodyText=o:t.blob&&Blob.prototype.isPrototypeOf(o)?this._bodyBlob=o:t.formData&&FormData.prototype.isPrototypeOf(o)?this._bodyFormData=o:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)?this._bodyText=o.toString():t.arrayBuffer&&t.blob&&r(o)?(this._bodyArrayBuffer=W(o.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(o)||a(o))?this._bodyArrayBuffer=W(o):this._bodyText=o=Object.prototype.toString.call(o):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof o=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var o=g(this);if(o)return o;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var o=g(this);return o||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(me);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var o=g(this);if(o)return o;if(this._bodyBlob)return ye(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(be(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(Ae)}),this.json=function(){return this.text().then(JSON.parse)},this}var ge=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function we(o){var i=o.toUpperCase();return ge.indexOf(i)>-1?i:o}function _(o,i){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');i=i||{};var u=i.body;if(o instanceof _){if(o.bodyUsed)throw new TypeError("Already read");this.url=o.url,this.credentials=o.credentials,i.headers||(this.headers=new f(o.headers)),this.method=o.method,this.mode=o.mode,this.signal=o.signal,!u&&o._bodyInit!=null&&(u=o._bodyInit,o.bodyUsed=!0)}else this.url=String(o);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new f(i.headers)),this.method=we(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in e){var c=new AbortController;return c.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&u)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(u),(this.method==="GET"||this.method==="HEAD")&&(i.cache==="no-store"||i.cache==="no-cache")){var p=/([?&])_=[^&]*/;if(p.test(this.url))this.url=this.url.replace(p,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})};function Ae(o){var i=new FormData;return o.trim().split("&").forEach(function(u){if(u){var p=u.split("="),y=p.shift().replace(/\+/g," "),c=p.join("=").replace(/\+/g," ");i.append(decodeURIComponent(y),decodeURIComponent(c))}}),i}function _e(o){var i=new f,u=o.replace(/\r?\n[\t ]+/g," ");return u.split("\r").map(function(p){return p.indexOf(`
`)===0?p.substr(1,p.length):p}).forEach(function(p){var y=p.split(":"),c=y.shift().trim();if(c){var C=y.join(":").trim();try{i.append(c,C)}catch(B){console.warn("Response "+B.message)}}}),i}Q.call(_.prototype);function w(o,i){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=i.statusText===void 0?"":""+i.statusText,this.headers=new f(i.headers),this.url=i.url||"",this._initBody(o)}Q.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},w.error=function(){var o=new w(null,{status:200,statusText:""});return o.ok=!1,o.status=0,o.type="error",o};var De=[301,302,303,307,308];w.redirect=function(o,i){if(De.indexOf(i)===-1)throw new RangeError("Invalid status code");return new w(null,{status:i,headers:{location:o}})},s.DOMException=e.DOMException;try{new s.DOMException}catch(o){s.DOMException=function(i,u){this.message=i,this.name=u;var p=Error(i);this.stack=p.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function U(o,i){return new Promise(function(u,p){var y=new _(o,i);if(y.signal&&y.signal.aborted)return p(new s.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function C(){c.abort()}c.onload=function(){var b={statusText:c.statusText,headers:_e(c.getAllResponseHeaders()||"")};y.url.indexOf("file://")===0&&(c.status<200||c.status>599)?b.status=200:b.status=c.status,b.url="responseURL"in c?c.responseURL:b.headers.get("X-Request-URL");var x="response"in c?c.response:c.responseText;setTimeout(function(){u(new w(x,b))},0)},c.onerror=function(){setTimeout(function(){p(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){p(new TypeError("Network request timed out"))},0)},c.onabort=function(){setTimeout(function(){p(new s.DOMException("Aborted","AbortError"))},0)};function B(b){try{return b===""&&e.location.href?e.location.href:b}catch(x){return b}}if(c.open(y.method,B(y.url),!0),y.credentials==="include"?c.withCredentials=!0:y.credentials==="omit"&&(c.withCredentials=!1),"responseType"in c&&(t.blob?c.responseType="blob":t.arrayBuffer&&(c.responseType="arraybuffer")),i&&typeof i.headers=="object"&&!(i.headers instanceof f||e.Headers&&i.headers instanceof e.Headers)){var Y=[];Object.getOwnPropertyNames(i.headers).forEach(function(b){Y.push(l(b)),c.setRequestHeader(b,m(i.headers[b]))}),y.headers.forEach(function(b,x){Y.indexOf(x)===-1&&c.setRequestHeader(x,b)})}else y.headers.forEach(function(b,x){c.setRequestHeader(x,b)});y.signal&&(y.signal.addEventListener("abort",C),c.onreadystatechange=function(){c.readyState===4&&y.signal.removeEventListener("abort",C)}),c.send(typeof y._bodyInit=="undefined"?null:y._bodyInit)})}U.polyfill=!0,e.fetch||(e.fetch=U,e.Headers=f,e.Request=_,e.Response=w),s.Headers=f,s.Request=_,s.Response=w,s.fetch=U,Object.defineProperty(s,"__esModule",{value:!0})})});var ue=re((Ge,ae)=>{ie();ae.exports=self.fetch.bind(self)});var se="WebPixel::Render";var N=s=>shopify.extend(se,s);var $e=ve(ue());function Ce(s){return oe(this,null,function*(){if(s.status>=200&&s.status<400)return s;if(s.status>=400&&s.status<500){let t=yield s.json(),r=new Error(t.error_message);return r.response=s,r.details=t,r.authIssue=!0,Promise.reject(r)}let e=new Error(s.statusText);return e.response=s,Promise.reject(e)})}function ce(s,n={}){var a=n,{accessToken:e,headers:t}=a,r=te(a,["accessToken","headers"]);let l={accept:"application/json"},m=e?{authorization:`Bearer ${e}`}:{};return r=T({credentials:"same-origin",headers:T(T(T({},l),m),t)},r),fetch(s,r).then(Ce).then(h=>[204,304].includes(h.status)?{}:h.json()).catch(h=>{if(h instanceof TypeError){let f=new Error("Your internet connection appears to have gone down.");return f.noNet=!0,Promise.reject(f)}return Promise.reject(h)})}var je="app.xenonview.com",Ee=`https://${je}`,L=class{constructor(e={}){let{name:t,method:r,headers:n,url:a,skipName:l,authenticated:m,apiUrl:h}=e;this.authenticated=m||!1,this.skipName=l||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=n||{"content-type":"application/json"},this.apiUrl=h||h!=null?h:Ee,this.path_=a||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(a){return Promise.reject(a)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let a={parameters:t};this.skipName||(a.name=this.name);let l=JSON.stringify(a);r.body=l}if(this.authenticated){let{token:a}=e;if(a)r.accessToken=a;else return Promise.reject(new Error("No token and authenticated!"))}let n=`${this.apiUrl}/${this.path(e)}`;return ce(n,r)}},D=L;function ke(s){let{journey:e}=s;return e?{journey:e}:{}}var F=class extends D{constructor(e){let t={name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0};super(t)}params(e){let t=ke(e),{id:r,timestamp:n}=e;return t.uuid=r,t.timestamp=n,t}};function Ue(s){return new F(s)}var le=Ue;function Be(s){let{journey:e}=s;return e?{journey:e}:{}}var H=class extends D{constructor(e){let t={name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Be(e),{id:r,tags:n,platform:a,timestamp:l,watchdog:m}=e;return t.uuid=r,t.timestamp=l,t.tags=n,t.platform=a,m&&(t.watchdog=m),t}};function Ie(s){return new H(s)}var de=Ie;var J=class extends D{constructor(e){let t={name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t,person:r,timestamp:n}=e;if(!r)throw new Error("No person data received.");let a={};return a.uuid=t,a.person=r,a.timestamp=n,a}};function Re(s){return new J(s)}var fe=Re;var X=class extends D{constructor(e){let t={name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t}=e,r={};return r.uuid=t,r}};function Ne(s){return new X(s)}var he=Ne;var M={},Le={setItem:(s,e)=>M[s]=e,getItem:s=>M[s],removeItem:s=>delete M[s]},q={},Fe={setItem:(s,e)=>q[s]=e,getItem:s=>q[s],removeItem:s=>delete q[s]};function V(){return typeof window!="undefined"&&window!==void 0&&window&&window.localStorage?window.localStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.localStorage?browser.localStorage:Fe}function z(){return typeof window!="undefined"&&window!==void 0&&window&&window.sessionStorage?window.sessionStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.sessionStorage?browser.sessionStorage:Le}function A(s,e){V().setItem(s,JSON.stringify(e))}function S(s){let e=V().getItem(s);return e?JSON.parse(e):null}function v(s){V().removeItem(s)}function P(s,e){z().setItem(s,JSON.stringify(e))}function O(s){let e=z().getItem(s);return e?JSON.parse(e):null}function K(s){z().removeItem(s)}var k=class{constructor(e=null,t="https://app.xenonview.com",r=le,n=fe,a=de,l=he){this.JourneyApi=r,this.DeanonApi=n,this.HeartbeatApi=a,this.SampleApi=l,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiUrl=t,e&&this.init(e,t)}init(e,t="https://app.xenonview.com",r=null){this.apiUrl=t,this.apiKey=e,this.sampleDecision(null,r)}ecomAbandonment(){A("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){A("heartbeat_type","custom"),A("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){A("heartbeat_type","custom"),A("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,n){P("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:n})}removePlatform(){K("view-platform")}variant(e){P("view-tags",e)}resetVariants(){K("view-tags")}leadAttributed(e,t){let r={superOutcome:"Lead Attributed",outcome:e,result:"success"};t&&(r.id=t),this.outcomeAdd(r)}leadCaptured(e){let t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){let t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){let t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){let t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){let e={superOutcome:"Application Installation",outcome:"Installed",result:"success"};this.outcomeAdd(e)}applicationNotInstalled(){let e={superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"};this.outcomeAdd(e)}initialSubscription(e,t=null,r=null,n=null){let a={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionDeclined(e,t=null,r=null,n=null){let a={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionRenewed(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionPaused(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionCanceled(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionUpsold(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionUpsellDeclined(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionDownsell(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}adClicked(e,t=null,r=null){let n={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(n.id=t),r&&(n.price=r),this.outcomeAdd(n)}adIgnored(e,t=null,r=null){let n={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(n.id=t),r&&(n.price=r),this.outcomeAdd(n)}referral(e,t=null){let r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){let r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t),this.heartbeatState(1)}productNotAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r)}upsellDismissed(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(){let e={superOutcome:"Customer Checkout",outcome:"Check Out",result:"success"};this.outcomeAdd(e),this.heartbeatState(2)}checkoutCanceled(){let e={superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"};this.outcomeAdd(e)}productRemoved(e){let t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null){let r={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r),this.heartbeatState(3)}purchaseCancel(e=null,t=null){let n={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(n.price=t),this.outcomeAdd(n)}promiseFulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"};this.outcomeAdd(e)}promiseUnfulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"};this.outcomeAdd(e)}productKept(e){let t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){let t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){let r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){let r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){let r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){let r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){let n={category:"Content",action:"Edited",type:e};t&&(n.identifier=t),r&&(n.details=r),this.journeyAdd(n)}contentCreated(e,t=null){let r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){let r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){let r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){let r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){let t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){let r={category:"Performance",action:"Page Load Time - "+e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,n){let a={category:e,action:t,name:r,details:n};this.journeyAdd(a)}commit(e=!1){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(t).catch(r=>(this.restore(),e?Promise.reject(r):Promise.resolve(!0)))}heartbeatState(e=null){let t=S("heartbeat_stage");return e&&e>t&&A("heartbeat_stage",e),!e&&!t&&A("heartbeat_stage",0),Number(S("heartbeat_stage"))}heartbeatMessage(e){let t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:S("heartbeat_outcome")}heartbeat(e=!1){let t=O("view-platform"),r=O("view-tags"),n={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:new Date().getTime()/1e3}},a=S("heartbeat_type");return a&&(n.data.watchdog=this.heartbeatMessage(a)),this.sampleDecision()?(this.reset(),this.HeartbeatApi(this.apiUrl).fetch(n).then(l=>(a&&Object.keys(n.data.watchdog).includes("remove")&&(v("heartbeat_stage"),v("heartbeat_type"),v("heartbeat_outcome")),Promise.resolve(l))).catch(l=>(this.restore(),e?Promise.reject(l):Promise.resolve(!0)))):Promise.resolve(!0)}deanonymize(e){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&P("xenon-view",e),e=O("xenon-view"),!e||e===""?this.newId():e}newId(){return P("xenon-view",crypto.randomUUID()),O("xenon-view")}sampleDecision(e=null,t=null){if(e!==null&&P("xenon-will-sample",e),e=O("xenon-will-sample"),e===null||e===""){let r={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(r).then(n=>{e=this.sampleDecision(n.sample,t)}).catch(n=>{if(n.authIssue&&t){t(n);return}e=this.sampleDecision(!0,t)})}return e=e!==null?!!e:null,e}outcomeAdd(e){let t=O("view-platform");t&&(e.platform=t);let r=O("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=new Date().getTime()/1e3,t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let n=r.hasOwnProperty("count")?r.count:1;r.count=n+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){let r=Object.keys(e),n=Object.keys(t);return!((l,m)=>{for(let h of m)if(!l.has(h))return!1;return!0})(new Set(r),new Set(n))||!n.includes("category")||!r.includes("category")||t.category!==e.category||!n.includes("action")||!r.includes("action")||t.action!==e.action?!1:this.duplicateFeature(e,t,r,n)||this.duplicateContent(e,t,r,n)||this.duplicateMilestone(e,t,r,n)}duplicateFeature(e,t,r,n){return t.category!=="Feature"||e.category!=="Feature"?!1:t.name===e.name}duplicateContent(e,t,r,n){return t.category!=="Content"||e.category!=="Content"?!1:!n.includes("type")&&!r.includes("type")?!0:t.type!==e.type?!1:!n.includes("identifier")&&!r.includes("identifier")?!0:t.identifier!==e.identifier?!1:!n.includes("details")&&!r.includes("details")?!0:t.details===e.details}duplicateMilestone(e,t,r,n){return t.category==="Feature"||e.category==="Feature"||t.category==="Content"||e.category==="Content"||t.name!==e.name?!1:t.details===e.details}journey(){return S("view-journey")}storeJourney(e){A("view-journey",e)}reset(){this.restoreJourney=this.journey(),v("view-journey"),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){let n=(a,l,m,h)=>h>=m?!1:a.className.toString().includes(l)?!0:a.parentElement?n(a.parentElement,l,m,h+1):!1;return n(e,t,r,0)}};var He=new k,d=He;var G="1.0.2";var pe=s=>{console.log("xenon-capture:%c Error: "+s,"color: #ff0000")};N(s=>{let e=s.settings.debug&&(s.settings.debug==="1"||s.settings.debug.toLowerCase()==="true"),t=(r,...n)=>{e&&console.log("%c"+r,"color: #3333cc",...n)};s.settings.apiKey?(d.init(s.settings.apiKey,null,r=>{pe(r.message)}),d.ecomAbandonment()):pe("No API Key configured"),s.analytics.subscribe("all_events",r=>{switch(r.name){case"collection_viewed":d.contentViewed("Collection",r.data.collection.title),t("Xenon.contentViewed","Collection",r.data.collection.title);break;case"checkout_contact_info_submitted":let n={email:r.data.checkout.email,name:[r.data.checkout.billingAddress.firstName,r.data.checkout.billingAddress.lastName].join(" ")};d.deanonymize(n).then(()=>{d.heartbeat()}),t("Xenon.deanonymize",n);break;case"checkout_shipping_info_submitted":d.contentCreated("shipping"),t("Xenon.contentCreated","shipping"),d.heartbeat();break;case"payment_info_submitted":d.contentCreated("billing"),t("Xenon.contentCreated","billing"),d.heartbeat();break;case"product_added_to_cart":d.productAddedToCart(r.data.cartLine.merchandise.product.id),t("Xenon.productAddedToCart",r.data.cartLine.merchandise.product.id),d.heartbeat();break;case"product_removed_from_cart":d.productRemoved(r.data.cartLine.merchandise.product.id),t("Xenon.productRemoved",r.data.cartLine.merchandise.product.id),s.init.data.cart.totalQuantity===0&&(d.cancelAbandonment(),t("Xenon.cancelAbandonment")),d.heartbeat();break;case"checkout_completed":r.data.checkout.transactions.map(g=>{d.milestone("Selection","Payment","Used",g.gateway),t("Xenon.milestone","Selection","Payment","Used",g.gateway)});let a=r.data.checkout.lineItems.map(g=>g.id),l=r.data.checkout.totalPrice.amount;d.purchase(a,l),t("Xenon.purchase",a,l),d.heartbeat();break;case"clicked":if(r.data.element.tagName!=="INPUT"){let g=r.data.element.tagName.charAt(0)+r.data.element.tagName.slice(1).toLowerCase()+r.data.element.type.charAt(0).toUpperCase()+r.data.element.type.slice(1);d.milestone(g,r.data.element.id,r.type,r.data.element.value),t("Xenon.milestone",g,r.data.element.id,r.type,r.data.element.value),d.heartbeat()}break;case"input_blurred":case"input_focused":break;case"input_changed":let m=r.data.element.tagName.charAt(0)+r.data.element.tagName.slice(1).toLowerCase()+r.data.element.type.charAt(0).toUpperCase()+r.data.element.type.slice(1);d.milestone(m,r.data.element.id,r.type,r.data.element.value),t("Xenon.milestone",m,r.data.element.id,r.type,r.data.element.value),d.heartbeat();break;case"xenon_link":d.milestone("Link",r.customData.id,r.customData.href,r.customData.text),t("Xenon.milestone","Link",r.customData.id,r.customData.href,r.customData.text),d.heartbeat();break;case"xenon_input":let h="Input"+r.customData.type.charAt(0).toUpperCase()+r.customData.type.slice(1);d.milestone(h,r.customData.id,r.customData.class,r.customData.text),t("Xenon.milestone",h,r.customData.id,r.customData.class,r.customData.text),d.heartbeat();break;case"xenon_button":let f="Button"+r.customData.type.charAt(0).toUpperCase()+r.customData.type.slice(1);d.milestone(f,r.customData.id,r.customData.class,r.customData.text),t("Xenon.milestone",f,r.customData.id,r.customData.class,r.customData.text),d.heartbeat();break;case"page_viewed":break;case"xenon_timing":s.browser.sessionStorage.getItem("xenon-platform").then(g=>{d.pageLoadTime(r.customData.loadTime.toString(),r.customData.href),t("Xenon.pageLoadTime:",r.customData.loadTime,r.customData.href),g||(d.platform(G,"Pixel",r.customData.platform,s.init.context.navigator.userAgent),t("Xenon.platform",G,"Pixel",r.customData.platform,s.init.context.navigator.userAgent),s.browser.sessionStorage.setItem("xenon-platform",r.customData.platform)),d.heartbeat()});break;default:e&&console.log("%cXenon unmapped:","color: #ff8c00",r)}})});})();
