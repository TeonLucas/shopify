(()=>{var we=Object.create;var k=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols,Se=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var Y=(s,e,t)=>e in s?k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,j=(s,e)=>{for(var t in e||(e={}))F.call(e,t)&&Y(s,t,e[t]);if(E)for(var t of E(e))Z.call(e,t)&&Y(s,t,e[t]);return s};var Q=(s,e)=>{var t={};for(var r in s)F.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&E)for(var r of E(s))e.indexOf(r)<0&&Z.call(s,r)&&(t[r]=s[r]);return t};var ee=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var _e=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Oe(e))!F.call(s,n)&&n!==t&&k(s,n,{get:()=>e[n],enumerable:!(r=ve(e,n))||r.enumerable});return s};var xe=(s,e,t)=>(t=s!=null?we(Se(s)):{},_e(e||!s||!s.__esModule?k(t,"default",{value:s,enumerable:!0}):t,s));var te=(s,e,t)=>new Promise((r,n)=>{var a=h=>{try{m(t.next(h))}catch(f){n(f)}},l=h=>{try{m(t.throw(h))}catch(f){n(f)}},m=h=>h.done?r(h.value):Promise.resolve(h.value).then(a,l);m((t=t.apply(s,e)).next())});var se=ee((D,oe)=>{(function(s,e){typeof D=="object"&&typeof oe!="undefined"?e(D):typeof define=="function"&&define.amd?define(["exports"],e):e(s.WHATWGFetch={})})(D,function(s){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(o){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(o){return o&&DataView.prototype.isPrototypeOf(o)}if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(o){return o&&n.indexOf(Object.prototype.toString.call(o))>-1};function l(o){if(typeof o!="string"&&(o=String(o)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(o)||o==="")throw new TypeError('Invalid character in header field name: "'+o+'"');return o.toLowerCase()}function m(o){return typeof o!="string"&&(o=String(o)),o}function h(o){var i={next:function(){var u=o.shift();return{done:u===void 0,value:u}}};return t.iterable&&(i[Symbol.iterator]=function(){return i}),i}function f(o){this.map={},o instanceof f?o.forEach(function(i,u){this.append(u,i)},this):Array.isArray(o)?o.forEach(function(i){if(i.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+i.length);this.append(i[0],i[1])},this):o&&Object.getOwnPropertyNames(o).forEach(function(i){this.append(i,o[i])},this)}f.prototype.append=function(o,i){o=l(o),i=m(i);var u=this.map[o];this.map[o]=u?u+", "+i:i},f.prototype.delete=function(o){delete this.map[l(o)]},f.prototype.get=function(o){return o=l(o),this.has(o)?this.map[o]:null},f.prototype.has=function(o){return this.map.hasOwnProperty(l(o))},f.prototype.set=function(o,i){this.map[l(o)]=m(i)},f.prototype.forEach=function(o,i){for(var u in this.map)this.map.hasOwnProperty(u)&&o.call(i,this.map[u],u,this)},f.prototype.keys=function(){var o=[];return this.forEach(function(i,u){o.push(u)}),h(o)},f.prototype.values=function(){var o=[];return this.forEach(function(i){o.push(i)}),h(o)},f.prototype.entries=function(){var o=[];return this.forEach(function(i,u){o.push([u,i])}),h(o)},t.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function R(o){if(!o._noBody){if(o.bodyUsed)return Promise.reject(new TypeError("Already read"));o.bodyUsed=!0}}function X(o){return new Promise(function(i,u){o.onload=function(){i(o.result)},o.onerror=function(){u(o.error)}})}function de(o){var i=new FileReader,u=X(i);return i.readAsArrayBuffer(o),u}function he(o){var i=new FileReader,u=X(i),d=/charset=([A-Za-z0-9_-]+)/.exec(o.type),p=d?d[1]:"utf-8";return i.readAsText(o,p),u}function pe(o){for(var i=new Uint8Array(o),u=new Array(i.length),d=0;d<i.length;d++)u[d]=String.fromCharCode(i[d]);return u.join("")}function G(o){if(o.slice)return o.slice(0);var i=new Uint8Array(o.byteLength);return i.set(new Uint8Array(o)),i.buffer}function $(){return this.bodyUsed=!1,this._initBody=function(o){this.bodyUsed=this.bodyUsed,this._bodyInit=o,o?typeof o=="string"?this._bodyText=o:t.blob&&Blob.prototype.isPrototypeOf(o)?this._bodyBlob=o:t.formData&&FormData.prototype.isPrototypeOf(o)?this._bodyFormData=o:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)?this._bodyText=o.toString():t.arrayBuffer&&t.blob&&r(o)?(this._bodyArrayBuffer=G(o.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(o)||a(o))?this._bodyArrayBuffer=G(o):this._bodyText=o=Object.prototype.toString.call(o):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof o=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(o)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var o=R(this);if(o)return o;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var o=R(this);return o||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(de);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var o=R(this);if(o)return o;if(this._bodyBlob)return he(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(pe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(be)}),this.json=function(){return this.text().then(JSON.parse)},this}var me=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function ye(o){var i=o.toUpperCase();return me.indexOf(i)>-1?i:o}function A(o,i){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');i=i||{};var u=i.body;if(o instanceof A){if(o.bodyUsed)throw new TypeError("Already read");this.url=o.url,this.credentials=o.credentials,i.headers||(this.headers=new f(o.headers)),this.method=o.method,this.mode=o.mode,this.signal=o.signal,!u&&o._bodyInit!=null&&(u=o._bodyInit,o.bodyUsed=!0)}else this.url=String(o);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new f(i.headers)),this.method=ye(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in e){var c=new AbortController;return c.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&u)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(u),(this.method==="GET"||this.method==="HEAD")&&(i.cache==="no-store"||i.cache==="no-cache")){var d=/([?&])_=[^&]*/;if(d.test(this.url))this.url=this.url.replace(d,"$1_="+new Date().getTime());else{var p=/\?/;this.url+=(p.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function be(o){var i=new FormData;return o.trim().split("&").forEach(function(u){if(u){var d=u.split("="),p=d.shift().replace(/\+/g," "),c=d.join("=").replace(/\+/g," ");i.append(decodeURIComponent(p),decodeURIComponent(c))}}),i}function ge(o){var i=new f,u=o.replace(/\r?\n[\t ]+/g," ");return u.split("\r").map(function(d){return d.indexOf(`
`)===0?d.substr(1,d.length):d}).forEach(function(d){var p=d.split(":"),c=p.shift().trim();if(c){var T=p.join(":").trim();try{i.append(c,T)}catch(N){console.warn("Response "+N.message)}}}),i}$.call(A.prototype);function b(o,i){if(!(this instanceof b))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=i.statusText===void 0?"":""+i.statusText,this.headers=new f(i.headers),this.url=i.url||"",this._initBody(o)}$.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},b.error=function(){var o=new b(null,{status:200,statusText:""});return o.ok=!1,o.status=0,o.type="error",o};var Ae=[301,302,303,307,308];b.redirect=function(o,i){if(Ae.indexOf(i)===-1)throw new RangeError("Invalid status code");return new b(null,{status:i,headers:{location:o}})},s.DOMException=e.DOMException;try{new s.DOMException}catch(o){s.DOMException=function(i,u){this.message=i,this.name=u;var d=Error(i);this.stack=d.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function I(o,i){return new Promise(function(u,d){var p=new A(o,i);if(p.signal&&p.signal.aborted)return d(new s.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function T(){c.abort()}c.onload=function(){var y={statusText:c.statusText,headers:ge(c.getAllResponseHeaders()||"")};p.url.indexOf("file://")===0&&(c.status<200||c.status>599)?y.status=200:y.status=c.status,y.url="responseURL"in c?c.responseURL:y.headers.get("X-Request-URL");var O="response"in c?c.response:c.responseText;setTimeout(function(){u(new b(O,y))},0)},c.onerror=function(){setTimeout(function(){d(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){d(new TypeError("Network request timed out"))},0)},c.onabort=function(){setTimeout(function(){d(new s.DOMException("Aborted","AbortError"))},0)};function N(y){try{return y===""&&e.location.href?e.location.href:y}catch(O){return y}}if(c.open(p.method,N(p.url),!0),p.credentials==="include"?c.withCredentials=!0:p.credentials==="omit"&&(c.withCredentials=!1),"responseType"in c&&(t.blob?c.responseType="blob":t.arrayBuffer&&(c.responseType="arraybuffer")),i&&typeof i.headers=="object"&&!(i.headers instanceof f||e.Headers&&i.headers instanceof e.Headers)){var W=[];Object.getOwnPropertyNames(i.headers).forEach(function(y){W.push(l(y)),c.setRequestHeader(y,m(i.headers[y]))}),p.headers.forEach(function(y,O){W.indexOf(O)===-1&&c.setRequestHeader(O,y)})}else p.headers.forEach(function(y,O){c.setRequestHeader(O,y)});p.signal&&(p.signal.addEventListener("abort",T),c.onreadystatechange=function(){c.readyState===4&&p.signal.removeEventListener("abort",T)}),c.send(typeof p._bodyInit=="undefined"?null:p._bodyInit)})}I.polyfill=!0,e.fetch||(e.fetch=I,e.Headers=f,e.Request=A,e.Response=b),s.Headers=f,s.Request=A,s.Response=b,s.fetch=I,Object.defineProperty(s,"__esModule",{value:!0})})});var ie=ee((Me,ne)=>{se();ne.exports=self.fetch.bind(self)});var re="WebPixel::Render";var J=s=>shopify.extend(re,s);var qe=xe(ie());function je(s){return te(this,null,function*(){if(s.status>=200&&s.status<400)return s;if(s.status>=400&&s.status<500){let t=yield s.json(),r=new Error(t.error_message);return r.response=s,r.details=t,Promise.reject(r)}let e=new Error(s.statusText);return e.response=s,Promise.reject(e)})}function ae(s,n={}){var a=n,{accessToken:e,headers:t}=a,r=Q(a,["accessToken","headers"]);let l={accept:"application/json"},m=e?{authorization:`Bearer ${e}`}:{};return r=j({credentials:"same-origin",headers:j(j(j({},l),m),t)},r),fetch(s,r).then(je).then(h=>[204,304].includes(h.status)?{}:h.json()).catch(h=>{if(h instanceof TypeError){let f=new Error("Your internet connection appears to have gone down.");return f.noNet=!0,Promise.reject(f)}return Promise.reject(h)})}var Pe="app.xenonview.com",Te=`https://${Pe}`,H=class{constructor(e={}){let{name:t,method:r,headers:n,url:a,skipName:l,authenticated:m,apiUrl:h}=e;this.authenticated=m||!1,this.skipName=l||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=n||{"content-type":"application/json"},this.apiUrl=h||h!=null?h:Te,this.path_=a||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(a){return Promise.reject(a)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let a={parameters:t};this.skipName||(a.name=this.name);let l=JSON.stringify(a);r.body=l}if(this.authenticated){let{token:a}=e;if(a)r.accessToken=a;else return Promise.reject(new Error("No token and authenticated!"))}let n=`${this.apiUrl}/${this.path(e)}`;return ae(n,r)}},w=H;function Ee(s){let{journey:e}=s;return e?{journey:e}:{}}var L=class extends w{constructor(e){let t={name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Ee(e),{id:r,timestamp:n}=e;return t.uuid=r,t.timestamp=n,t}};function De(s){return new L(s)}var ue=De;function Ce(s){let{journey:e}=s;return e?{journey:e}:{}}var M=class extends w{constructor(e){let t={name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Ce(e),{id:r,tags:n,platform:a,timestamp:l,watchdog:m}=e;return t.uuid=r,t.timestamp=l,t.tags=n,t.platform=a,m&&(t.watchdog=m),t}};function Be(s){return new M(s)}var ce=Be;var q=class extends w{constructor(e){let t={name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t,person:r,timestamp:n}=e;if(!r)throw new Error("No person data received.");let a={};return a.uuid=t,a.person=r,a.timestamp=n,a}};function Ue(s){return new q(s)}var le=Ue;var V=class extends w{constructor(e){let t={name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t}=e,r={};return r.uuid=t,r}};function Re(s){return new V(s)}var fe=Re;var C={},B={},S=typeof localStorage!="undefined"&&typeof sessionStorage!="undefined";function g(s,e){S?localStorage.setItem(s,JSON.stringify(e)):C[s]=JSON.stringify(e)}function _(s){let e;return S?e=JSON.parse(localStorage.getItem(s)):C[s]&&(e=JSON.parse(C[s])),e}function P(s){S?localStorage.removeItem(s):C[s]=null}function x(s,e){S?sessionStorage.setItem(s,JSON.stringify(e)):B[s]=JSON.stringify(e)}function v(s){let e;return S?e=JSON.parse(sessionStorage.getItem(s)):B[s]&&(e=JSON.parse(B[s])),e}function z(s){S?sessionStorage.removeItem(s):B[s]=null}var U=class{constructor(e=null,t="https://app.xenonview.com",r=ue,n=le,a=ce,l=fe){this.JourneyApi=r,this.DeanonApi=n,this.HeartbeatApi=a,this.SampleApi=l,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiUrl=t,e&&this.init(e,t)}init(e,t="https://app.xenonview.com"){this.apiUrl=t,this.apiKey=e,this.sampleDecision()}ecomAbandonment(){g("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){g("heartbeat_type","custom"),g("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){g("heartbeat_type","custom"),g("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,n){x("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:n})}removePlatform(){z("view-platform")}variant(e){x("view-tags",e)}resetVariants(){z("view-tags")}leadAttributed(e,t){let r={superOutcome:"Lead Attributed",outcome:e,result:"success"};t&&(r.id=t),this.outcomeAdd(r)}leadCaptured(e){let t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){let t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){let t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){let t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){let e={superOutcome:"Application Installation",outcome:"Installed",result:"success"};this.outcomeAdd(e)}applicationNotInstalled(){let e={superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"};this.outcomeAdd(e)}initialSubscription(e,t=null,r=null,n=null){let a={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionDeclined(e,t=null,r=null,n=null){let a={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionRenewed(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionPaused(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionCanceled(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionUpsold(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionUpsellDeclined(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}subscriptionDownsell(e,t=null,r=null,n=null){let a={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(a.method=t),r&&(a.price=r),n&&(a.term=n),this.outcomeAdd(a)}adClicked(e,t=null,r=null){let n={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(n.id=t),r&&(n.price=r),this.outcomeAdd(n)}adIgnored(e,t=null,r=null){let n={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(n.id=t),r&&(n.price=r),this.outcomeAdd(n)}referral(e,t=null){let r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){let r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t),this.heartbeatState(1)}productNotAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r)}upsellDismissed(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(){let e={superOutcome:"Customer Checkout",outcome:"Check Out",result:"success"};this.outcomeAdd(e),this.heartbeatState(2)}checkoutCanceled(){let e={superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"};this.outcomeAdd(e)}productRemoved(e){let t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null){let r={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r),this.heartbeatState(3)}purchaseCancel(e=null,t=null){let n={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(n.price=t),this.outcomeAdd(n)}promiseFulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"};this.outcomeAdd(e)}promiseUnfulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"};this.outcomeAdd(e)}productKept(e){let t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){let t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){let r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){let r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){let r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){let r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){let n={category:"Content",action:"Edited",type:e};t&&(n.identifier=t),r&&(n.details=r),this.journeyAdd(n)}contentCreated(e,t=null){let r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){let r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){let r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){let r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){let t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){let r={category:"Performance",action:"Page Load Time - "+e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,n){let a={category:e,action:t,name:r,details:n};this.journeyAdd(a)}commit(e=!1){if(!this.sampleDecision())return new Promise.resolve;let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(t).catch(r=>(this.restore(),e?Promise.reject(r):Promise.resolve()))}heartbeatState(e=null){let t=_("heartbeat_stage");return e&&e>t&&g("heartbeat_stage",e),!e&&!t&&g("heartbeat_stage",0),Number(_("heartbeat_stage"))}heartbeatMessage(e){let t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:_("heartbeat_outcome")}heartbeat(e=!1){let t=v("view-platform"),r=v("view-tags"),n={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:new Date().getTime()/1e3}},a=_("heartbeat_type");return a&&(n.data.watchdog=this.heartbeatMessage(a)),this.sampleDecision()?(this.reset(),this.HeartbeatApi(this.apiUrl).fetch(n).then(l=>(a&&Object.keys(n.data.watchdog).includes("remove")&&(P("heartbeat_stage"),P("heartbeat_type"),P("heartbeat_outcome")),Promise.resolve(l))).catch(l=>(this.restore(),e?Promise.reject(l):Promise.resolve()))):new Promise.resolve}deanonymize(e){if(!this.sampleDecision())return new Promise.resolve;let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&x("xenon-view",e),e=v("xenon-view"),!e||e===""?this.newId():e}newId(){return x("xenon-view",crypto.randomUUID()),v("xenon-view")}sampleDecision(e=null){if(e!==null&&x("xenon-will-sample",e),e=v("xenon-will-sample"),e===null||e===""){let t={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(t).then(r=>{e=this.sampleDecision(r.sample)}).catch(r=>{e=this.sampleDecision(!0)})}return e=e!==null?!!e:null,e}outcomeAdd(e){let t=v("view-platform");t&&(e.platform=t);let r=v("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=new Date().getTime()/1e3,t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let n=r.hasOwnProperty("count")?r.count:1;r.count=n+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){let r=Object.keys(e),n=Object.keys(t);return!((l,m)=>{for(let h of m)if(!l.has(h))return!1;return!0})(new Set(r),new Set(n))||!n.includes("category")||!r.includes("category")||t.category!==e.category||!n.includes("action")||!r.includes("action")||t.action!==e.action?!1:this.duplicateFeature(e,t,r,n)||this.duplicateContent(e,t,r,n)||this.duplicateMilestone(e,t,r,n)}duplicateFeature(e,t,r,n){return t.category!=="Feature"||e.category!=="Feature"?!1:t.name===e.name}duplicateContent(e,t,r,n){return t.category!=="Content"||e.category!=="Content"?!1:!n.includes("type")&&!r.includes("type")?!0:t.type!==e.type?!1:!n.includes("identifier")&&!r.includes("identifier")?!0:t.identifier!==e.identifier?!1:!n.includes("details")&&!r.includes("details")?!0:t.details===e.details}duplicateMilestone(e,t,r,n){return t.category==="Feature"||e.category==="Feature"||t.category==="Content"||e.category==="Content"||t.name!==e.name?!1:t.details===e.details}journey(){return _("view-journey")}storeJourney(e){g("view-journey",e)}reset(){this.restoreJourney=this.journey(),P("view-journey"),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){let n=(a,l,m,h)=>h>=m?!1:a.className.toString().includes(l)?!0:a.parentElement?n(a.parentElement,l,m,h+1):!1;return n(e,t,r,0)}};var Ie=new U,K=Ie;J(s=>{let e=s.settings.debug&&(s.settings.debug==="1"||s.settings.debug.toLowerCase()==="true");if(s.settings.apiKey){K.init(s.settings.apiKey);let t=K.id();s.browser.localStorage.setItem("xenonId",t).then(()=>{e&&console.log("xenon-id:",t)})}else console.log("Error: No Xenon API Key configured");s.analytics.subscribe("all_standard_events",t=>{e&&(console.log("xenon-capture event:",t),console.log("xenon-capture init:",s.init))}),s.analytics.subscribe("xenon",t=>{let r=JSON.parse(t.customData.timing);e&&(console.log("xenon-capture timing:",r),console.log("xenon-capture settings:",s.settings))})});})();
